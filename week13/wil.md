### 1) LSM 트리

정의: 로그 구조를 사용하는 트리로, 쓰기 작업의 성능을 향상시키기 위해 설계됨.
배경: B-트리와 달리, 버퍼링과 순차 기록 방식을 사용하여 쓰기 효율을 높임.
구성: 메모리 테이블과 디스크 기반 SSTable(디스크 테이블)로 구성됨.
활용: Cassandra, LevelDB, RocksDB 등에서 사용.

LSM 트리의 특성
쓰기 지연: 데이터를 메모리에 저장한 뒤 주기적으로 디스크에 플러시(flush).
불변 파일: 디스크에 저장된 파일은 수정 불가 → 오로지 읽기/병합만 가능.
병합(Merge): 디스크에 있는 여러 파일을 주기적으로 정렬/병합해 성능 최적화.
순차 읽기 적합 구조: 싱글 패스(sequential access)에 유리함.

### 2) 디스크 저장과 병합
디스크에 저장된 레코드는 읽기 효율을 위해 세그먼트 단위로 구성됨.
배타적 잠금 필요: 동시에 여러 레벨을 읽거나 쓸 경우 충돌 방지를 위해 잠금 필요.
읽기 시 레벨별로 순차 탐색, 요청 데이터가 존재하는 테이블만 추려서 검색

### 3) 컴포넌트 구성

1. 이중 컴포넌트 LSM 트리 (Two-component)
구성: 메모리 테이블+ 디스크 테이블 하나
동작: 디스크 테이블이 가득 차면 새로운 테이블에 정렬 결과를 덮어쓰기
플러시 대상: 메모리에 있는 내용을 디스크에 순차 저장
특징: 정렬된 상태를 유지하여 빠른 병합이 가능

2. 다중 컴포넌트 LSM 트리 (Multicomponent)
구성: 여러 개의 디스크 테이블로 구성
컴팩션: 디스크 테이블이 많아질수록 주기적으로 정리
효율성: 여러 테이블을 읽지 않도록 정기적으로 병합

### 4) 메모리 테이블과 플러시 과정
MemTable: 메모리 상에 유지되는 정렬된 테이블
플러시 대상: 일정량 이상이면 디스크로 저장
읽기 상태 구분:
최신 MemTable: 읽기/쓰기 가능
플러시 중: 읽기 가능
온디스크 플러시 대상: 읽기 불가 (미완료 상태)

### 5) 정렬과 삭제
LSM 트리는 디스크에서 삭제하지 않음: 삭제 레코드를 삽입하여 처리
툼스톤: 키가 삭제되었음을 나타내는 특수 표식
조정: 툼스톤 포함된 레코드를 제거하며 디스크 테이블 정리

삭제 처리 방식: 디스크에서 직접 삭제 X, Tombstone 기록 → 컴팩션 시 최종 제거
-> 범위 삭제는 start_tombstone_inclusive, end_tombstone_exclusive로 표시

### 6) 병합과 반복자
: Multi-way merge sort로 여러 테이블 병합
반복자는 각 디스크 테이블의 레코드 순서를 유지하며 다음 레코드로 이동
우선순위 큐를 사용해 가장 작은 키 정렬 유지
중복 키 존재 시 가장 최신(타임스탬프 기준) 레코드만 유지

### 7) 조정
: 병합 결과를 바탕으로 중복 제거 및 충돌 해결
	같은 키의 여러 버전 중 최신만 남김
  삭제된 키는 tombstone을 확인 후 제거

### 8) 유지보수 작업
: 디스크 공간 확보 위해 Shadow 처리 및 삭제 / 불필요한 레코드 제거, 디스크 테이블 수 감소
컴팩션 알고리즘으로 정렬된 디스크 테이블 재구성

1. 컴팩션 전략
: Tombstone & Compaction / GC(Garbage Collection)와 유사 / tombstone 존재 시 컴팩션 대상 포함

- 레벨형 Compaction
: RocksDB 등에서 사용, 레벨마다 크기 제한 → 0 → 1 → 2 레벨 순차 이동, 상위 레벨로 이동할수록 크기 증가 (계수적 증가)

- 크기 단계별 Compaction
: 크기가 유사한 테이블끼리 병합 / 크기 기준으로 그룹화 → 큰 테이블은 높은 레벨로 이동

2. 컴팩션 최적화 고려사항
문제점: Table Starvation; 작은 테이블이 너무 자주 컴팩션되어 비효율 발생, 큰 테이블은 병합 기회 부족으로 디스크 낭비

- 알고리즘 전략
Time window compaction: 유효 시간 기준 컴팩션 / Write Amplification 최소화 전략 포함

### 9) 읽기, 쓰기, 메모리 공간 증폭
읽기 증폭: 여러 테이블 탐색해야 함, 쓰기 증폭: 반복된 재작성 발생, 공간 증폭: 중복 데이터 및 tombstone으로 디스크 공간 낭비